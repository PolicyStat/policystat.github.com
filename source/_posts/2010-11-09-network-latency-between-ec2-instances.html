---
layout: post
title: "Network latency between ec2 instances: public vs private IP and same vs different availability zone"
date: 2010-11-09 15:07
permalink: network-latency-between-ec2-instances-public
comments: true
author: Wes Winham
categories:
- aws
- ec2
- devops
---

<h2>How Realistic is Your ec2 =&gt; ec2 Load Test?</h2>
<p>Today I was reading about a cool distributed load-testing tool called <a href="http://blog.apps.chicagotribune.com/2010/07/08/bees-with-machine-guns/">Bees With Machine Guns</a>&nbsp;(awesome name) and a commenter asked how testing ec2 to ec2 might affect the load test. After all, real clients aren't going to have local network connection speeds to your application, which is going to change the characteristics of how your application responds. With slow clients you get increased resource usage depending on your setup and you'd probably like to know whether or not putting that reverse proxy in front of your application server actually helps.</p>
<p>I was going to suggest in the comments that using a different availability zone would actually solve the problem, but then I realized I was just guessing. So I ran some simple, unscientific tests.</p>
<h2>Results Summary</h2>
<p><img src="http://chart.apis.google.com/chart?cht=bhs&amp;chs=450x130&amp;chd=t:.5,2,81.7&amp;chtt=EC2%20Network%20Latency%20(ms)&amp;chco=4D89F9&amp;chxt=x,y&amp;chxl=1:|Different%20Region|Different%20AZ|Same%20AZ" alt="EC2 Network Latency Graph" /></p>
<p>In a nutshell, if you want mostly-realistic ec2=&gt;ec2 load tests, put your load testing instances in another region. As you would suspect, using the internal vs external DNS entry doesn't matter (except for your bill) and moving to another availability zone still gives you super quick connection speed. While moving your tests to another region won't give you the variance you need for realistic tests (there are tools for this, though), it is a dead-simple way to get a more-realistic picture of what your application does under load.&nbsp;</p>
<p>The average response times I received:</p>
<ul>
    <li>00.5 ms- Same Region, Same Availability Zone</li>
    <li>02.0 ms- Same Region, Different Availability Zone</li>
    <li>81.7 ms- Different Region</li>
</ul>
<h2>Test Methodology</h2>
<p>I spun up 4 instances with 32-bit ubuntu 10.04-based images and ran pings between them using both the public and the private DNS entry. I ran a couple of pings to start to take care of caching the DNS lookup and then I ran:</p>
<pre>$ ping address.to.ping -c 20</pre>
<p>Instances:</p>
<ul>
    <li>instance.a: high-cpu medium in us-east-<strong>1b</strong></li>
    <li>instance.b: high-cpu medium in us-east-<strong>1b</strong></li>
    <li>instance.c: high-cpu medium in us-east-<strong>1d</strong></li>
    <li>instance.d: high-cpu medium in us-west-<strong>1a</strong></li>
</ul>
<h3>Detailed Results</h3>
<h4>Same Region, Same Availability Zone</h4>
<p>instance.a =&gt; instance.b</p>
<p><em>Public DNS</em></p>
<pre>--- ping statistics ---
20 packets transmitted, 20 received, 0% packet loss, time 19087ms
rtt min/avg/max/mdev = 0.397/0.540/0.629/0.061 ms
</pre>
<p><em>Private DNS</em></p>
<pre>--- ping statistics ---
20 packets transmitted, 20 received, 0% packet loss, time 19096ms
rtt min/avg/max/mdev = 0.362/0.544/0.733/0.084 ms</pre>
<h4>Same Region, Different Availability Zone</h4>
<p>instance.a =&gt; instance.c</p>
<p><em>Public DNS</em></p>
<pre>--- ping statistics ---
20 packets transmitted, 20 received, 0% packet loss, time 19187ms
rtt min/avg/max/mdev = 1.817/2.035/3.113/0.260 ms
</pre>
<p><em>Private DNS</em></p>
<pre>--- ping statistics ---
20 packets transmitted, 20 received, 0% packet loss, time 19185ms
rtt min/avg/max/mdev = 1.790/1.936/2.051/0.078 ms
</pre>
<h4>Different Regions</h4>
<p>instance.a =&gt; instance.d</p>
<p><em>Public DNS</em></p>
<pre>--- ping statistics ---
20 packets transmitted, 20 received, 0% packet loss, time 19176ms
rtt min/avg/max/mdev = 81.517/81.672/82.059/0.281 ms
</pre>
<p><em>Private DNS</em></p>
<p>Not Available</p>
