
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>PolicyStat's Dev Blog: PHP to Django: Changing the engine while the car is running</title>
  <meta name="author" content="PolicyStat LLC">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  

  <link rel="canonical" href="http://devblog.policystat.comphp-to-django-changing-the-engine-while-the-c"/>
  <link href="/favicon.png" rel="shortcut icon" />
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="http://s3.amazonaws.com/ender-js/jeesh.min.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="http://feeds.feedburner.com/policystatdevblog" rel="alternate" title="PolicyStat's Dev Blog" type="application/atom+xml"/>
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-2228017-6']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


  
  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>


  
  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>


  <!--Fonts from Google's Web font directory at http://google.com/webfonts -->
<link href='http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic' rel='stylesheet' type='text/css'>

</head>

<body  >
  <header><hgroup>
  <h1><a href="/">PolicyStat's Dev Blog</a></h1>
  
</hgroup>

</header>
  <nav role=navigation><ul role=subscription data-subscription="rss">
  <li><a href="http://feeds.feedburner.com/policystatdevblog" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
<form action="http://google.com/search" method="get">
  <fieldset role="site-search">
    <input type="hidden" name="q" value="site:devblog.policystat.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
<ul role=main-navigation>
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry">
  
  <header>
    
      <h1 class="entry-title">PHP to Django: Changing the Engine While the Car Is Running</h1>
    
    
      <p class="meta">




<time datetime="2010-11-15 15:07:00 -0500" pubdate  updated >Nov 15<span>th</span>, 2010</time>


</p>
    
  </header>


<div class="entry-content"><p>It&#8217;s pretty widely known that web frameworks like
<a href="http://djangoproject.com">Django</a> and <a href="http://rubyonrails.org">Ruby on Rails</a>
are amazing. They give developers the ability to build applications quickly and
reliably and there&#8217;s all sorts of hotness when it comes to tools and community
and reusable applications. But what if <em>your</em> application isn&#8217;t using a web
framework? Are you doomed to be outmaneuvered by your competitors?</p>

<h2>It Takes a Choice</h2>

<p>PolicyStat, like most ideas, was born out of a prototype. In our case, the
prototype was written in PHP with the kind of architecture you&#8217;d expect from a
prototype. There were 45 .php files in a folder with one file called
class.main.php. No templates. No classes. No consistent database access. No
MVC. No ORM. No tests.</p>

<p><img src="/images/posts/php-to-django/first_commit.png.scaled500.png" alt="First Commit" /></p>

<p>Once our prototype took off and we realized there was a strong market for
policy management software done exactly the way we wanted to do it, we had a
decision to make. Should we focus on improving our existing code base? Port
things to one of the PHP web frameworks? Switch languages all together? As
someone who believes the <a href="http://www.joelonsoftware.com/articles/fog0000000069.html">Single Worst Mistake</a>
a software company can make is rewriting from scratch, it was still
obvious that moving to Django was in the best interest of our company (and my
sanity). We decided to have our cake and eat it too.</p>

<h2>Integration Version 1</h2>

<p>After a lot of hard thinking, we realized that if we could somehow get a Django
project to share sessions with our existing PHP prototype, we could keep both
codebases active at the same time while we slowly ported functionality from PHP
over to Django. Our integration process went something like this:</p>

<ol>
<li>Create models.py files and break them up by functionality in to separate apps
using Django&#8217;s great <a href="http://docs.djangoproject.com/en/1.2/howto/legacy-databases/">legacy database</a>
support.</li>
<li>Build a <a href="http://docs.djangoproject.com/en/dev/topics/http/sessions/#configuring-the-session-engine">Django Session Engine</a>
using <a href="http://pypi.python.org/pypi/phpserialize">phpserialize</a> to speak PHP&#8217;s
serialization format.</li>
<li>Duplicate the HTML templates spread out in various .php includes to Django&#8217;s
superior <a href="http://docs.djangoproject.com/en/dev/topics/templates/#template-inheritance">Template Inheritance</a>
system.</li>
<li>Separate PHP and Django based on URL paths via the Apache configuration
(mod_php and mod_python at the time).</li>
</ol>


<p>In the end, it only took a couple of weeks to get to a very basic level of
integration. A vast majority of PolicyStat was still in PHP, but a couple of
pages were served from Django. The key was that this change was seamless from a
user&#8217;s perspective. We didn&#8217;t even need to explain to customers that anything
was changing, because it didn&#8217;t matter from their end. We were able to continue
delivering normal enhancements and bug fixes while doing the initial
integration.</p>

<h2>Toward 100% Django</h2>

<p>Once you get the bare minimum level of integration, the hard, non-technical
problem to solve is what you should do from there. On one end, you can shut
down feature development and bug fixes for a few months while you attempt to
port the remaining PHP portions bit by bit. On the other end, you can choose to
be a dual-backend application forever and ever, amen.</p>

<p>We took the position that the PHP portions of our application were just pieces
of code that needed refactoring. Once we made that decision our process
naturally fell out; we already knew how to handle less-than-perfect code. When
we added new features, they were done in Python and Django. When we needed to
polish or otherwise fix functionality that lived in PHP, we looked at it just
like you&#8217;d look at that super-ugly method you wrote a couple of years ago when
you were in a hurry. If it was a very small change, we tended to just make the
change in PHP. If it was a decent chunk of change, or the change would be
easier in python, we first wrote unit tests on what we expected the behavior to
be using the existing code as a guide, then we ported the code to Django and
made the fix. During that time, we continued to deliver regular product
updates.</p>

<h2>22 Months Later</h2>

<p>So finally, after 22 months of regular updates and massive product improvements
(including a major architectural revampt to support multi-tenancy), we finally
removed the last bit of PHP. It was a very, very, very happy day for the
development team. To our customers though, it was just another update. That&#8217;s a
good thing :)</p>

<p><img src="/images/posts/php-to-django/last_php.png" alt="last php removal" /></p>

<h2>Notes</h2>

<ul>
<li>Django and Ruby on Rails are the best examples, but there are plenty of
other great frameworks. The major decision is between using a solid web
framework and not using one.</li>
<li>Yes there are reasons not to move your app to a web framework, but if
you&#8217;re basing your business around an application, there aren&#8217;t many
situations where your organization wouldn&#8217;t stand to benefit.</li>
<li>If anyone is interested, I&#8217;d be happy to do a followup post with a more
technical look at the django session engine we used and maybe what our
apache vhost file looked like.</li>
</ul>


<p>Edit: Finally finished the follow-up post with technical details on <a href="/php-to-django-how-we-did-it">migrating
from php to django</a>.</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">PolicyStat LLC</span></span>

      




<time datetime="2010-11-15 15:07:00 -0500" pubdate  updated >Nov 15<span>th</span>, 2010</time>



      

<span class="categories">
  
    <a class='category' href='/blog/categories/django/'>django</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://devblog.policystat.comphp-to-django-changing-the-engine-while-the-c" data-via="policystat" data-counturl="http://devblog.policystat.comphp-to-django-changing-the-engine-while-the-c" >Tweet</a>
  
  
  <g:plusone size="medium"></g:plusone>
  
</div>

    
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread"><div id="disqus_thread"></div>
<script type="text/javascript">
  var disqus_developer = 0;
  if (document.domain != "http://devblog.policystat.com") {
      disqus_developer = 1;
  }

  var disqus_shortname = 'policystatdevblog';
  var disqus_identifier = 'http://devblog.policystat.comphp-to-django-changing-the-engine-while-the-c';
  var disqus_url = 'http://devblog.policystat.comphp-to-django-changing-the-engine-while-the-c';
  //var disqus_developer = 1;
  (function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside role=sidebar>
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="where-are-the-magic-deployment-tools">Where are the magic deployment tools?</a>
      </li>
    
      <li class="post">
        <a href="run-mysql-from-a-ram-disk-in-ubuntu">Run MySQL From a RAM Disk in Ubuntu Linux</a>
      </li>
    
      <li class="post">
        <a href="policypad-real-time-collaboration-through-you">PolicyPad: Etherpad + Bring Your Own Editor</a>
      </li>
    
      <li class="post">
        <a href="todays-amazon-ec2-ebs-outage-in-a-graph">Today&#8217;s Amazon ec2 EBS Outage in a Graph</a>
      </li>
    
      <li class="post">
        <a href="php-to-django-how-we-did-it">PHP to Django: How we did it</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  <script type="text/javascript">
    $.domReady(function(){
      getTwitterFeed("policystat", 4, false);
    });
  </script>
  <script src="/javascripts/twitter.js" type="text/javascript"> </script>
  
    <a href="http://twitter.com/policystat" class="twitter-follow-button" data-width="208px" data-show-count="false">Follow @policystat</a>
  
</section>




  
</aside>


    </div>
  </div>
  <footer><p>
  Copyright &copy; 2011 - PolicyStat LLC -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
</body>
</html>
