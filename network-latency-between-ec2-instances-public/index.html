
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>PolicyStat's Dev Blog: Network latency between ec2 instances: public vs private IP and same vs different availability zone</title>
  <meta name="author" content="PolicyStat LLC">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  

  <link rel="canonical" href="http://devblog.policystat.com/network-latency-between-ec2-instances-public"/>
  <link href="/favicon.ico" rel="shortcut icon" />
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="http://s3.amazonaws.com/ender-js/jeesh.min.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="http://feeds.feedburner.com/policystatdevblog" rel="alternate" title="PolicyStat's Dev Blog" type="application/atom+xml"/>
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-2228017-6']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


  
  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>


  
  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>


  <!--Fonts from Google's Web font directory at http://google.com/webfonts -->
<link href='http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic' rel='stylesheet' type='text/css'>

</head>

<body  >
  <header><hgroup>
  <h1><a href="/">PolicyStat's Dev Blog</a></h1>
  
</hgroup>

</header>
  <nav role=navigation><ul role=subscription data-subscription="rss">
  <li><a href="http://feeds.feedburner.com/policystatdevblog" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
<form action="http://google.com/search" method="get">
  <fieldset role="site-search">
    <input type="hidden" name="q" value="site:devblog.policystat.com/" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
<ul role=main-navigation>
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/about">About Us</a></li>
  <li><a href="http://www.policystat.com">PolicyStat Homepage</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry">
  
  <header>
    
      <h1 class="entry-title">Network Latency Between Ec2 Instances: Public vs Private IP and Same vs Different Availability Zone</h1>
    
    
      <p class="meta">




<time datetime="2010-11-09 15:07:00 -0500" pubdate  updated >Nov 9<span>th</span>, 2010</time>


</p>
    
  </header>


<div class="entry-content"><h2>How Realistic is Your ec2 =&gt; ec2 Load Test?</h2>
<p>Today I was reading about a cool distributed load-testing tool called <a href="http://blog.apps.chicagotribune.com/2010/07/08/bees-with-machine-guns/">Bees With Machine Guns</a>&nbsp;(awesome name) and a commenter asked how testing ec2 to ec2 might affect the load test. After all, real clients aren&#8217;t going to have local network connection speeds to your application, which is going to change the characteristics of how your application responds. With slow clients you get increased resource usage depending on your setup and you&#8217;d probably like to know whether or not putting that reverse proxy in front of your application server actually helps.</p>
<p>I was going to suggest in the comments that using a different availability zone would actually solve the problem, but then I realized I was just guessing. So I ran some simple, unscientific tests.</p>
<h2>Results Summary</h2>
<p><img src="http://chart.apis.google.com/chart?cht=bhs&amp;chs=450x130&amp;chd=t:.5,2,81.7&amp;chtt=EC2%20Network%20Latency%20(ms)&amp;chco=4D89F9&amp;chxt=x,y&amp;chxl=1:|Different%20Region|Different%20AZ|Same%20AZ" alt="EC2 Network Latency Graph" /></p>
<p>In a nutshell, if you want mostly-realistic ec2=&gt;ec2 load tests, put your load testing instances in another region. As you would suspect, using the internal vs external DNS entry doesn&#8217;t matter (except for your bill) and moving to another availability zone still gives you super quick connection speed. While moving your tests to another region won&#8217;t give you the variance you need for realistic tests (there are tools for this, though), it is a dead-simple way to get a more-realistic picture of what your application does under load.&nbsp;</p>
<p>The average response times I received:</p>
<ul>
    <li>00.5 ms- Same Region, Same Availability Zone</li>
    <li>02.0 ms- Same Region, Different Availability Zone</li>
    <li>81.7 ms- Different Region</li>
</ul>
<h2>Test Methodology</h2>
<p>I spun up 4 instances with 32-bit ubuntu 10.04-based images and ran pings between them using both the public and the private DNS entry. I ran a couple of pings to start to take care of caching the DNS lookup and then I ran:</p>
<pre>$ ping address.to.ping -c 20</pre>
<p>Instances:</p>
<ul>
    <li>instance.a: high-cpu medium in us-east-<strong>1b</strong></li>
    <li>instance.b: high-cpu medium in us-east-<strong>1b</strong></li>
    <li>instance.c: high-cpu medium in us-east-<strong>1d</strong></li>
    <li>instance.d: high-cpu medium in us-west-<strong>1a</strong></li>
</ul>
<h3>Detailed Results</h3>
<h4>Same Region, Same Availability Zone</h4>
<p>instance.a =&gt; instance.b</p>
<p><em>Public DNS</em></p>
<pre>--- ping statistics ---
20 packets transmitted, 20 received, 0% packet loss, time 19087ms
rtt min/avg/max/mdev = 0.397/0.540/0.629/0.061 ms
</pre>
<p><em>Private DNS</em></p>
<pre>--- ping statistics ---
20 packets transmitted, 20 received, 0% packet loss, time 19096ms
rtt min/avg/max/mdev = 0.362/0.544/0.733/0.084 ms</pre>
<h4>Same Region, Different Availability Zone</h4>
<p>instance.a =&gt; instance.c</p>
<p><em>Public DNS</em></p>
<pre>--- ping statistics ---
20 packets transmitted, 20 received, 0% packet loss, time 19187ms
rtt min/avg/max/mdev = 1.817/2.035/3.113/0.260 ms
</pre>
<p><em>Private DNS</em></p>
<pre>--- ping statistics ---
20 packets transmitted, 20 received, 0% packet loss, time 19185ms
rtt min/avg/max/mdev = 1.790/1.936/2.051/0.078 ms
</pre>
<h4>Different Regions</h4>
<p>instance.a =&gt; instance.d</p>
<p><em>Public DNS</em></p>
<pre>--- ping statistics ---
20 packets transmitted, 20 received, 0% packet loss, time 19176ms
rtt min/avg/max/mdev = 81.517/81.672/82.059/0.281 ms
</pre>
<p><em>Private DNS</em></p>
<p>Not Available</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Wes Winham</span></span>

      




<time datetime="2010-11-09 15:07:00 -0500" pubdate  updated >Nov 9<span>th</span>, 2010</time>



      

<span class="categories">
  
    <a class='category' href='/blog/categories/aws/'>aws</a>, <a class='category' href='/blog/categories/devops/'>devops</a>, <a class='category' href='/blog/categories/ec2/'>ec2</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://devblog.policystat.com/network-latency-between-ec2-instances-public" data-via="policystat" data-counturl="http://devblog.policystat.com/network-latency-between-ec2-instances-public" >Tweet</a>
  
  
  <g:plusone size="medium"></g:plusone>
  
</div>

    
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread"><div id="disqus_thread"></div>
<script type="text/javascript">
  var disqus_developer = 0;
  if (document.domain != "http://devblog.policystat.com/") {
      disqus_developer = 1;
  }

  var disqus_shortname = 'policystatdevblog';
  var disqus_identifier = 'http://devblog.policystat.com/network-latency-between-ec2-instances-public';
  var disqus_url = 'http://devblog.policystat.com/network-latency-between-ec2-instances-public';
  //var disqus_developer = 1;
  (function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside role=sidebar>
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="where-are-the-magic-deployment-tools">Where are the magic deployment tools?</a>
      </li>
    
      <li class="post">
        <a href="run-mysql-from-a-ram-disk-in-ubuntu">Run MySQL From a RAM Disk in Ubuntu Linux</a>
      </li>
    
      <li class="post">
        <a href="policypad-real-time-collaboration-through-you">PolicyPad: Etherpad + Bring Your Own Editor</a>
      </li>
    
      <li class="post">
        <a href="todays-amazon-ec2-ebs-outage-in-a-graph">Today&#8217;s Amazon ec2 EBS Outage in a Graph</a>
      </li>
    
      <li class="post">
        <a href="php-to-django-how-we-did-it">PHP to Django: How we did it</a>
      </li>
    
  </ul>
</section>



  
</aside>


    </div>
  </div>
  <footer><p>
  Copyright &copy; 2011 - PolicyStat LLC -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
</body>
</html>
